(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d7e65"],{"797d":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{afterClose:e.onClosed,bodyStyle:{padding:0},maskClosable:!1,width:680,destroyOnClose:""},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.modalTitle)+" "),e.loading?a("a-icon",{attrs:{type:"loading"}}):e._e()]},proxy:!0}]),model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[a("div",{staticClass:"card-container"},[a("a-tabs",{attrs:{type:"card"}},[a("a-tab-pane",{key:"normal",attrs:{tab:"常规"}},[a("a-form",{attrs:{"label-col":{span:4},"wrapper-col":{span:20},labelAlign:"left"}},[a("a-form-item",{attrs:{label:"文章标题"}},[a("a-input",{model:{value:e.form.model.title,callback:function(t){e.$set(e.form.model,"title",t)},expression:"form.model.title"}})],1),a("a-form-item",{attrs:{help:e.fullPath,label:"文章别名"}},[a("a-input",{scopedSlots:e._u([{key:"addonAfter",fn:function(){return[a("a-popconfirm",{attrs:{"cancel-text":"取消","ok-text":"确定",placement:"left",title:"是否确定根据标题重新生成别名？"},on:{confirm:e.handleGenerateSlug}},[a("a-icon",{staticClass:"cursor-pointer",attrs:{type:"sync"}})],1)]},proxy:!0}]),model:{value:e.form.model.slug,callback:function(t){e.$set(e.form.model,"slug",t)},expression:"form.model.slug"}})],1),a("a-form-item",{attrs:{label:"分类目录"}},[a("category-tree",{model:{value:e.form.model.categoryIds,callback:function(t){e.$set(e.form.model,"categoryIds",t)},expression:"form.model.categoryIds"}})],1),a("a-form-item",{attrs:{label:"标签"}},[a("TagSelect",{model:{value:e.form.model.tagIds,callback:function(t){e.$set(e.form.model,"tagIds",t)},expression:"form.model.tagIds"}})],1),a("a-form-item",{attrs:{label:"摘要"}},[a("a-input",{attrs:{autoSize:{minRows:5},placeholder:"如不填写，会从文章中自动截取",type:"textarea"},model:{value:e.form.model.summary,callback:function(t){e.$set(e.form.model,"summary",t)},expression:"form.model.summary"}})],1)],1)],1),a("a-tab-pane",{key:"advanced",attrs:{tab:"高级"}},[a("a-form",{attrs:{"label-col":{span:4},"wrapper-col":{span:20},labelAlign:"left"}},[a("a-form-item",{attrs:{label:"禁止评论"}},[a("a-switch",{model:{value:e.form.model.disallowComment,callback:function(t){e.$set(e.form.model,"disallowComment",t)},expression:"form.model.disallowComment"}})],1),a("a-form-item",{attrs:{label:"是否置顶"}},[a("a-switch",{model:{value:e.topPriority,callback:function(t){e.topPriority=t},expression:"topPriority"}})],1),a("a-form-item",{attrs:{label:"发表时间："}},[a("a-date-picker",{attrs:{defaultValue:e.createTimeDefaultValue,format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择文章发表时间",showTime:""},on:{change:e.onCreateTimeSelect,ok:e.onCreateTimeSelect}})],1),a("a-form-item",{attrs:{label:"自定义模板："}},[a("a-select",{model:{value:e.form.model.template,callback:function(t){e.$set(e.form.model,"template",t)},expression:"form.model.template"}},[a("a-select-option",{key:"",attrs:{value:""}},[e._v("无")]),e._l(e.templates,(function(t){return a("a-select-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])}))],2)],1),a("a-form-item",{attrs:{label:"访问密码："}},[a("a-input-password",{attrs:{autocomplete:"new-password"},model:{value:e.form.model.password,callback:function(t){e.$set(e.form.model,"password",t)},expression:"form.model.password"}})],1),a("a-form-item",{attrs:{label:"封面图："}},[a("div",{staticClass:"post-thumb"},[a("a-space",{attrs:{direction:"vertical"}},[a("img",{staticClass:"img",attrs:{src:e.form.model.thumbnail||"/images/placeholder.jpg",alt:"Post cover thumbnail"},on:{click:function(t){e.attachmentSelectVisible=!0}}}),a("a-input",{attrs:{placeholder:"点击封面图选择图片，或者输入外部链接"},model:{value:e.form.model.thumbnail,callback:function(t){e.$set(e.form.model,"thumbnail",t)},expression:"form.model.thumbnail"}}),a("a-button",{attrs:{type:"dashed"},on:{click:function(t){e.form.model.thumbnail=null}}},[e._v("移除")])],1)],1)])],1)],1),a("a-tab-pane",{key:"seo",attrs:{tab:"SEO"}},[a("a-form",{attrs:{"label-col":{span:4},"wrapper-col":{span:20},labelAlign:"left"}},[a("a-form-item",{attrs:{label:"自定义关键词"}},[a("a-input",{attrs:{autoSize:{minRows:5},placeholder:"多个关键词以英文逗号隔开，如不填写，将自动使用标签作为关键词",type:"textarea"},model:{value:e.form.model.metaKeywords,callback:function(t){e.$set(e.form.model,"metaKeywords",t)},expression:"form.model.metaKeywords"}})],1),a("a-form-item",{attrs:{label:"自定义描述"}},[a("a-input",{attrs:{autoSize:{minRows:5},placeholder:"如不填写，会从文章中自动截取",type:"textarea"},model:{value:e.form.model.metaDescription,callback:function(t){e.$set(e.form.model,"metaDescription",t)},expression:"form.model.metaDescription"}})],1)],1)],1),a("a-tab-pane",{key:"meta",attrs:{tab:"元数据"}},[a("MetaEditor",{attrs:{metas:e.form.model.metas,targetId:e.form.model.id,target:"post"},on:{"update:metas":function(t){return e.$set(e.form.model,"metas",t)}}})],1)],1)],1),a("template",{slot:"footer"},[e._t("extraFooter"),a("a-button",{attrs:{disabled:e.loading},on:{click:function(t){e.modalVisible=!1}}},[e._v(" 关闭 ")]),e.form.model.id?e._e():a("ReactiveButton",{attrs:{errored:e.form.draftSaveErrored,loading:e.form.draftSaving,erroredText:"保存失败",loadedText:"保存成功",text:"保存草稿",type:"danger"},on:{callback:e.handleSavedCallback,click:function(t){return e.handleCreateOrUpdate("DRAFT")}}}),a("ReactiveButton",{attrs:{errored:e.form.saveErrored,erroredText:(e.form.model.id?"保存":"发布")+"失败",loadedText:(e.form.model.id?"保存":"发布")+"成功",loading:e.form.saving,text:e.form.model.id?"保存":"发布"},on:{callback:e.handleSavedCallback,click:function(t){return e.handleCreateOrUpdate()}}})],2),a("AttachmentSelectDrawer",{attrs:{drawerWidth:480},on:{listenToSelect:e.handleSelectPostThumb},model:{value:e.attachmentSelectVisible,callback:function(t){e.attachmentSelectVisible=t},expression:"attachmentSelectVisible"}})],2)},o=[],n=(a("0d1f"),a("ae8f"),a("f830"),a("089c"),a("dd51"),a("9d84")),s=a("9a0b"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-tree",{attrs:{checkedKeys:e.categoryIds,treeData:e.categoryTree,checkStrictly:"",checkable:"",defaultExpandAll:"",showLine:""},on:{check:e.onCheck}})},i=[],c=(a("cb4c"),a("3ed1"));function m(e,t){t.forEach((function(t){e.key===t.parentId&&(e.children||(e.children=[]),e.children.push({key:t.id,title:t.name,isLeaf:!1}))})),e.children?e.children.forEach((function(e){return m(e,t)})):e.isLeaf=!0}function d(e){var t={key:0,title:"top",children:[]};return m(t,e),t.children}var u={name:"CategoryTree",model:{prop:"categoryIds",event:"check"},props:{categoryIds:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{categories:{data:[],loading:!1}}},computed:{categoryTree:function(){return this.categories.data.length?d(this.categories.data):[]}},created:function(){this.handleListCategories()},methods:{handleListCategories:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.categories.loading=!0,e.next=4,c["a"].category.list({sort:[],more:!1});case 4:t=e.sent,a=t.data,this.categories.data=a,e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),this.$log.error(e.t0);case 12:return e.prev=12,this.categories.loading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,9,12,15]])})));function t(){return e.apply(this,arguments)}return t}(),onCheck:function(e,t){this.$log.debug("Chekced keys",e),this.$log.debug("e",t),this.$emit("check",e.checked)}}},f=u,p=a("838c"),h=Object(p["a"])(f,l,i,!1,null,null,null),g=h.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-select",{staticClass:"w-full",attrs:{"token-separators":[",","|"],allowClear:"",mode:"tags",placeholder:"选择或输入标签"},on:{change:e.handleChange},model:{value:e.selectedTagNames,callback:function(t){e.selectedTagNames=t},expression:"selectedTagNames"}},e._l(e.tags,(function(t){return a("a-select-option",{key:t.id,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)},v=[],y=a("28d2"),k=a.n(y),w={name:"TagSelect",model:{prop:"tagIds",event:"change"},props:{tagIds:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{tags:[],selectedTagNames:[]}},created:function(){this.handleListTags()},watch:{tags:function(e){var t=this;e&&(this.selectedTagNames=this.tagIds.map((function(e){return t.tagIdMap[e].name})))},tagIds:{handler:function(e){var t=this;this.tags.length&&(this.selectedTagNames=e.map((function(e){return t.tagIdMap[e].name})))},deep:!0}},computed:{tagIdMap:function(){var e={};return this.tags.forEach((function(t){e[t.id]=t})),e},tagNameMap:function(){var e={};return this.tags.forEach((function(t){e[t.name]=t})),e}},methods:{handleListTags:function(e){var t=this;c["a"].tag.list({more:!0}).then((function(a){t.tags=a.data,e&&e()}))},handleChange:function(){var e=this,t=this.selectedTagNames.filter((function(t){return!e.tagNameMap[t]}));if(this.$log.debug("Tag names to create",t),t.length){var a=t.map((function(e){return c["a"].tag.create({name:e})}));k.a.all(a).then(k.a.spread((function(){e.handleListTags((function(){e.$log.debug("Tag name map",e.tagNameMap);var t=e.selectedTagNames.map((function(t){return e.tagNameMap[t].id}));e.$emit("change",t)}))})))}else{var r=this.selectedTagNames.map((function(t){return e.tagNameMap[t].id}));this.$emit("change",r)}}}},x=w,S=Object(p["a"])(x,b,v,!1,null,null,null),T=S.exports,C=a("5089"),O=a("1a86"),D=a("9158"),E=a("3b93"),$=a.n(E),j=a("bbf5");function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var I={name:"PostSettingModal",mixins:[O["a"],O["b"]],components:{CategoryTree:g,TagSelect:T,MetaEditor:C["a"]},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},post:{type:Object,default:function(){return{}}},savedCallback:{type:Function,default:null}},data:function(){return{form:{model:{},saving:!1,saveErrored:!1,draftSaving:!1,draftSaveErrored:!1},templates:[],attachmentSelectVisible:!1}},computed:Y(Y({},Object(j["c"])(["options"])),{},{modalVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},modalTitle:function(){return this.form.model.id?"文章设置":"文章发布"},createTimeDefaultValue:function(){if(this.form.model.createTime){var e=new Date(this.form.model.createTime);return Object(D["a"])(e,"YYYY-MM-DD HH:mm:ss")}return Object(D["a"])(new Date,"YYYY-MM-DD HH:mm:ss")},topPriority:{get:function(){return 0!==this.form.model.topPriority},set:function(e){this.form.model.topPriority=e?1:0}},fullPath:function(){var e=this.options.post_permalink_type,t=this.options.blog_url,a=this.options.archives_prefix,r=this.options.path_suffix||"",o=this.form.model.slug||"{slug}",n=this.form.model.createTime||new Date,s=this.form.model.id||"{id}";switch(e){case"DEFAULT":return"".concat(t,"/").concat(a,"/").concat(o).concat(r);case"YEAR":return"".concat(t).concat(Object(D["a"])(n,"/YYYY/")).concat(o).concat(r);case"DATE":return"".concat(t).concat(Object(D["a"])(n,"/YYYY/MM/")).concat(o).concat(r);case"DAY":return"".concat(t).concat(Object(D["a"])(n,"/YYYY/MM/DD/")).concat(o).concat(r);case"ID":return"".concat(t,"/?p=").concat(s);case"ID_SLUG":return"".concat(t,"/").concat(a,"/").concat(s).concat(r);default:return""}}}),watch:{modalVisible:function(e){e&&(this.form.model=Object.assign({},this.post),this.form.model.slug||this.form.model.id||this.handleGenerateSlug())},post:{deep:!0,handler:function(e){this.form.model=Object.assign({},e)}}},created:function(){this.handleListCustomTemplates()},methods:{handleCreateOrUpdate:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,a,r,o,n=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:"PUBLISHED",this.form.model.title){e.next=4;break}return this.$notification["error"]({message:"提示",description:"文章标题不能为空！"}),e.abrupt("return");case 4:if(this.form.model.status=t,a=this.form.model,r=a.id,o=a.status,e.prev=6,this.form["PUBLISHED"===o?"saving":"draftSaving"]=!0,!r){e.next=13;break}return e.next=11,c["a"].post.update(r,this.form.model);case 11:e.next=15;break;case 13:return e.next=15,c["a"].post.create(this.form.model);case 15:e.next=21;break;case 17:e.prev=17,e.t0=e["catch"](6),this.form["PUBLISHED"===o?"saveErrored":"draftSaveErrored"]=!0,this.$log.error(e.t0);case 21:return e.prev=21,setTimeout((function(){n.form.saving=!1,n.form.draftSaving=!1}),400),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[6,17,21,24]])})));function t(){return e.apply(this,arguments)}return t}(),handleSavedCallback:function(){this.form.saveErrored||this.form.draftSaveErrored?(this.form.saveErrored=!1,this.form.draftSaveErrored=!1):this.savedCallback&&this.savedCallback()},handleListCustomTemplates:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].theme.listCustomPostTemplates();case 3:t=e.sent,this.templates=t.data,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.$log.error(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),onCreateTimeSelect:function(e){this.form.model.createTime=e.valueOf()},handleGenerateSlug:function(){if(this.form.model.title&&$.a.isSupported()){var e,t="",a=$.a.parse(this.form.model.title.replace(/\s+/g,"").toLowerCase());a.forEach((function(a){if(2===a.type){var r=a.target?a.target.toLowerCase():"";t+=t&&!/\n|\s/.test(e.target)?"-"+r:r}else t+=(e&&2===e.type?"-":"")+a.target;e=a})),this.$set(this.form.model,"slug",t)}},handleSelectPostThumb:function(e){this.form.model.thumbnail=encodeURI(e.path),this.attachmentSelectVisible=!1},onClosed:function(){this.$emit("onClose"),this.$emit("onUpdate",this.form.model)}}},P=I,M=Object(p["a"])(P,r,o,!1,null,null,null);t["a"]=M.exports}}]);