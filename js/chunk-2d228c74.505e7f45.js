(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d228c74"],{db44:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-view",{attrs:{title:t.postToStage.title?t.postToStage.title:"新文章",affix:""}},[a("template",{slot:"extra"},[a("a-space",[a("ReactiveButton",{attrs:{errored:t.draftSaveErrored,loading:t.draftSaving,erroredText:"保存失败",loadedText:"保存成功",text:"保存草稿",type:"danger"},on:{callback:function(e){t.draftSaveErrored=!1},click:function(e){return t.handleSaveDraft(!1)}}}),a("a-button",{attrs:{loading:t.previewSaving},on:{click:t.handlePreview}},[t._v("预览")]),a("a-button",{attrs:{type:"primary"},on:{click:function(e){t.postSettingVisible=!0}}},[t._v("发布")]),a("a-button",{attrs:{type:"dashed"},on:{click:function(e){t.attachmentDrawerVisible=!0}}},[t._v("附件库")])],1)],1),a("a-row",{attrs:{gutter:12}},[a("a-col",{attrs:{span:24}},[a("div",{staticClass:"mb-4"},[a("a-input",{attrs:{placeholder:"请输入文章标题",size:"large"},model:{value:t.postToStage.title,callback:function(e){t.$set(t.postToStage,"title",e)},expression:"postToStage.title"}})],1),a("div",{style:{height:t.editorHeight},attrs:{id:"editor"}},[a("MarkdownEditor",{attrs:{originalContent:t.postToStage.originalContent},on:{onContentChange:t.onContentChange,onSaveDraft:function(e){return t.handleSaveDraft(!0)}}})],1)])],1),a("PostSettingModal",{attrs:{post:t.postToStage,savedCallback:t.onPostSavedCallback,visible:t.postSettingVisible},on:{"update:visible":function(e){t.postSettingVisible=e},onUpdate:t.onUpdateFromSetting}}),a("AttachmentDrawer",{model:{value:t.attachmentDrawerVisible,callback:function(e){t.attachmentDrawerVisible=e},expression:"attachmentDrawerVisible"}})],2)},o=[],i=a("1a86"),s=a("9158"),r=a("797d"),d=a("ed4e"),c=a("cd9f"),l=a("680a"),u=a("3ed1"),h={mixins:[i["a"],i["b"],i["c"]],components:{PostSettingModal:r["a"],AttachmentDrawer:d["a"],MarkdownEditor:c["a"],PageView:l["c"]},data:function(){return{attachmentDrawerVisible:!1,postSettingVisible:!1,postToStage:{},contentChanges:0,draftSaving:!1,previewSaving:!1,draftSaveErrored:!1}},beforeRouteEnter:function(t,e,a){var n=t.query.postId;a((function(t){n&&u["a"].post.get(n).then((function(e){t.postToStage=e.data}))}))},destroyed:function(){this.attachmentDrawerVisible&&(this.attachmentDrawerVisible=!1),window.onbeforeunload&&(window.onbeforeunload=null)},beforeRouteLeave:function(t,e,a){var n=this.$createElement;this.attachmentDrawerVisible&&(this.attachmentDrawerVisible=!1),this.contentChanges<=1?a():this.$confirm({title:"当前页面数据未保存，确定要离开吗？",content:function(){return n("div",{style:"color:red;"},["如果离开当面页面，你的数据很可能会丢失！"])},onOk:function(){a()},onCancel:function(){a(!1)}})},mounted:function(){window.onbeforeunload=function(t){return t=t||window.event,t&&(t.returnValue="当前页面数据未保存，确定要离开吗？"),"当前页面数据未保存，确定要离开吗？"}},methods:{handleSaveDraft:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$log.debug("Draft only: "+e),this.postToStage.status="DRAFT",this.postToStage.title||(this.postToStage.title=Object(s["a"])(new Date,"YYYY-MM-DD-HH-mm-ss")),this.draftSaving=!0,this.postToStage.id?e?u["a"].post.updateDraftById(this.postToStage.id,this.postToStage.originalContent).then((function(){t.handleRestoreSavedStatus()})).catch((function(){t.draftSaveErrored=!0})).finally((function(){setTimeout((function(){t.draftSaving=!1}),400)})):u["a"].post.update(this.postToStage.id,this.postToStage).then((function(e){t.postToStage=e.data,t.handleRestoreSavedStatus()})).catch((function(){t.draftSaveErrored=!0})).finally((function(){setTimeout((function(){t.draftSaving=!1}),400)})):u["a"].post.create(this.postToStage).then((function(e){t.postToStage=e.data,t.handleRestoreSavedStatus()})).catch((function(){t.draftSaveErrored=!0})).finally((function(){setTimeout((function(){t.draftSaving=!1}),400)}))},handlePreview:function(){var t=this;this.postToStage.status="DRAFT",this.postToStage.title||(this.postToStage.title=Object(s["a"])(new Date,"YYYY-MM-DD-HH-mm-ss")),this.previewSaving=!0,this.postToStage.id?u["a"].post.update(this.postToStage.id,this.postToStage).then((function(e){t.$log.debug("Updated post",e.data),u["a"].post.getPreviewLinkById(t.postToStage.id).then((function(e){window.open(e.data,"_blank"),t.handleRestoreSavedStatus()})).finally((function(){setTimeout((function(){t.previewSaving=!1}),400)}))})):u["a"].post.create(this.postToStage).then((function(e){t.$log.debug("Created post",e.data),t.postToStage=e.data,u["a"].post.getPreviewLinkById(t.postToStage.id).then((function(e){window.open(e.data,"_blank"),t.handleRestoreSavedStatus()})).finally((function(){setTimeout((function(){t.previewSaving=!1}),400)}))}))},handleRestoreSavedStatus:function(){this.contentChanges=0},onContentChange:function(t){this.contentChanges++,this.postToStage.originalContent=t},onPostSavedCallback:function(){this.contentChanges=0,this.$router.push({name:"PostList"})},onUpdateFromSetting:function(t){this.postToStage=t}}},p=h,g=a("838c"),f=Object(g["a"])(p,n,o,!1,null,null,null);e["default"]=f.exports}}]);